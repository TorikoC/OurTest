(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["testing"],{"28dd":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.session.loading?t._e():s("div",{staticClass:"testing-container flex-column pd-1"},[s("div",{staticClass:"flex-1 flex-column"},[t.session.preparing?s("before-test",{staticClass:"flex-1",attrs:{settings:t.session.test.settings,length:t.session.test.questions.length},on:{start:t.start}}):t.session.end?s("after-test",{attrs:{id:t.session.result._id}}):s("div",[s("div",{staticClass:"flex-row"},[s("span",{staticClass:"ml-auto exit",on:{click:t.exit}},[s("i",{staticClass:"fas fa-door-closed",on:{click:t.exit}}),t._v("\n          Exit\n        ")])]),s("question-card",{staticClass:"mt-1",attrs:{question:t.session.test.questions[t.session.currentIndex],index:t.session.currentIndex+1,reply:t.session.replys[t.session.currentIndex]},on:{complete:t.toComplete}}),s("div",{staticClass:"flex-row mt-1"},[t.session.test.settings.timerMode===t.$constants.ALL?s("button",{staticClass:"pure-button",on:{click:function(e){t.next(t.session.currentIndex-1)}}},[t._v("prev")]):t._e(),s("button",{staticClass:"pure-button",on:{click:function(e){t.next(t.session.currentIndex+1)}}},[t._v("next")]),s("button",{staticClass:"ml-auto pure-button pure-button-primary",on:{click:function(e){return e.preventDefault(),t.toSubmit(e)}}},[t._v("提交")])]),t.session.test.settings.timerMode===t.$constants.ALL?s("footer",{staticClass:"flex-row mt-1"},[s("ul",{staticClass:"pager flex-1"},t._l(t.session.test.questions.length,function(e){return s("li",{key:e,staticClass:"pager-index",class:{active:t.session.currentIndex+1===e,done:t.session.status[e-1]},attrs:{id:"pager-"+e},on:{click:function(s){t.next(e-1)}}},[s("span",[t._v(t._s(e))])])}))]):t._e()],1)],1),t.session.preparing||t.session.end?t._e():s("timer",{attrs:{"total-time":t.session.remainningTime,"total-questions-cnt":t.session.test.questions.length,"rest-questions-cnt":t.session.remainningQuestions},on:{timeout:t.toTimeout,"get-time":t.getTime}})],1)},n=[],o=(s("a481"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"text-sm text-light flex-column flex-center"},[s("div",{staticClass:"flex-item-center"},[t.settings.schedule&&!t.counting?s("div",[s("p",[t._v("\n        测试将于 "+t._s(t.settings.date+" : "+t.settings.time)+" 开放.\n      ")])]):s("div",[s("p",[t._v("\n        一共 "+t._s(t.length)+" 题\n      ")]),t.settings.timerMode===t.$constants.EACH?s("p",[t._v("\n        每题时间限制: \n        "+t._s(t.settings.timeLimit.minutes?t.settings.timeLimit.minutes+"分":"")+"\n        "+t._s(t.settings.timeLimit.seconds?t.settings.timeLimit.seconds+" 秒":"")+"\n      ")]):t.settings.timerMode===t.$constants.ALL?s("p",[t._v("\n        时间限制: \n        "+t._s(t.settings.timeLimit.minutes?t.settings.timeLimit.minutes+"分":"")+"\n        "+t._s(t.settings.timeLimit.seconds?t.settings.timeLimit.seconds+"秒":"")+"\n      ")]):t._e(),s("p",[t._v("\n        测试会在倒计时后开始\n      ")]),s("p",[t._v("\n        倒计时: "+t._s(t._f("clock")(t.remainingTime))+"\n      ")])])])])}),r=[],l=(s("c5f6"),{props:{settings:{type:Object,required:!0},length:{type:Number}},data:function(){return{remainingTime:3e3,counting:!1,countdownHandler:null}},mounted:function(){this.settings.schedule?Date.now()>this.settings.scheduleAt&&this.countdown():this.countdown()},methods:{countdown:function(){var t=this;this.counting=!0;var e=1e3;this.countdownHandler=setInterval(function(){t.remainingTime-=e,console.log(t.remainingTime),t.remainingTime<=0&&(clearInterval(t.countdownHandler),t.$emit("start"))},e)}}}),a=l,c=s("2877"),u=Object(c["a"])(a,o,r,!1,null,null,null);u.options.__file="before-test.vue";var m=u.exports,d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"text-center"},[s("p",[t._v("测试结束")]),s("a",{attrs:{href:"/results/"+t.id,target:"_blank"}},[t._v("查看结果")])])},h=[],p={props:{id:{type:String,required:!0}}},g=p,f=Object(c["a"])(g,d,h,!1,null,null,null);f.options.__file="after-test.vue";var _=f.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"clock",on:{click:t.toggleClock}},[t.mini?s("span",{staticClass:"clock--mini"},[t._v("\n    "+t._s(t._f("clock")(t.remainingTime))+"\n  ")]):s("dl",{staticClass:"clock--big"},[s("dt",[t._v(" 剩余时间 ")]),s("dd",[t._v(" "+t._s(t._f("clock")(t.remainingTime))+" ")]),s("dt",[t._v(" 总题数 ")]),s("dd",[t._v(" "+t._s(t.totalQuestionsCnt)+" ")]),s("dt",[t._v(" 剩余题数 ")]),s("dd",[t._v(" "+t._s(t.restQuestionsCnt)+" ")])])])},y=[],b={props:{totalTime:{type:Number},totalQuestionsCnt:{type:Number},restQuestionsCnt:{type:Number}},data:function(){return{remainingTime:0,handler:null,mini:!0,beginTime:0}},mounted:function(){var t=this,e=+localStorage.getItem("begin-time"),s=+localStorage.getItem("remaining-time");e?this.beginTime=e:(this.beginTime=Date.now(),localStorage.setItem("begin-time",this.beginTime)),this.remainingTime=s||this.totalTime;var i=1e3,n=function e(){t.remainingTime-=i,t.remainingTime<=0?(clearTimeout(t.handler),t.handler=null,localStorage.removeItem("remaining-time"),t.$emit("timeout",Date.now()-t.beginTime)):(localStorage.setItem("remaining-time",t.remainingTime),t.handler=setTimeout(e,i))};setTimeout(n,i),this.$bus.$on("testing-get-time",this.getTime)},destroyed:function(){this.$bus.$off("testing-get-time",this.getTime),clearTimeout(this.handler),localStorage.removeItem("begin-time"),localStorage.removeItem("remaining-time")},methods:{getTime:function(){this.$emit("get-time",Date.now()-this.beginTime)},toggleClock:function(){var t=this;this.mini?this.mini=!1:(document.getElementsByClassName("clock--big")[0].classList.add("slideOut"),setTimeout(function(){t.mini=!0},300))}}},x=b,C=(s("d4b6"),Object(c["a"])(x,v,y,!1,null,"1918de78",null));C.options.__file="timer.vue";var T=C.exports,I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"question-card flex-column"},[s("div",{staticClass:"question-card-header"},[t._v("\n    "+t._s(t.index+". "+t.question.desc)+"\n  ")]),s(t.question.type,{tag:"component",staticClass:"question-card-body flex-1",attrs:{data:t.question,reply:t.reply},on:{complete:t.complete}})],1)},$=[],E=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"single-choice-options"},t._l(t.data.options,function(e,i){return s("li",{key:e,staticClass:"mt-1"},[s("radio",{attrs:{id:"option"+i,message:e,name:"single-choice-options",checked:t.localReply===i},on:{change:function(e){t.changeOption(e,i)}}})],1)}))},L=[],k={props:{data:{type:Object,required:!0},reply:{default:-1}},data:function(){return{localReply:this.reply}},mounted:function(){this.$bus.$on("testing-next",this.submit)},destroyed:function(){this.$bus.$off("testing-next",this.submit)},methods:{changeOption:function(t,e){t.target.checked&&(this.localReply=e)},submit:function(t){this.$emit("complete",{reply:this.localReply,index:t.index,submit:t.submit})}}},q=k,w=Object(c["a"])(q,E,L,!1,null,null,null);w.options.__file="single-choice.vue";var O=w.exports,S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"flex-column"},t._l(t.data.options,function(e,i){return s("li",{key:e,staticClass:"option"},[s("checkbox",{attrs:{id:"option"+i,"checkbox-class":"mc-option",message:e,checked:!!(t.reply&&t.reply.length>i)&&t.reply[i]}})],1)}))},N=[],j={props:{data:{type:Object},reply:{}},mounted:function(){this.$bus.$on("testing-next",this.complete)},destroyed:function(){this.$bus.$off("testing-next",this.complete)},methods:{complete:function(t){for(var e=[],s=document.getElementsByClassName("mc-option"),i=0;i<s.length;i+=1)s[i].checked?e.push(!0):e.push(!1);this.$emit("complete",{reply:e,index:t.index,submit:t.submit})}}},Q=j,U=Object(c["a"])(Q,S,N,!1,null,null,null);U.options.__file="multiple-choice.vue";var P=U.exports,A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",t._l(t.data.answer.length,function(e){return s("li",{key:e,staticClass:"mt-1"},[s("label",{attrs:{for:""}},[t._v(t._s(e)+". ")]),s("input",{staticClass:"pure-input replys",attrs:{type:"text"},domProps:{value:t.reply&&t.reply[e-1]?t.reply[e-1]:""}})])}))},H=[],M={props:{data:{type:Object},reply:{type:String}},mounted:function(){this.$bus.$on("testing-next",this.complete)},destroyed:function(){this.$bus.$off("testing-next",this.complete)},methods:{complete:function(t){for(var e=[],s=document.getElementsByClassName("replys"),i=0;i<s.length;i+=1)e.push(s[i].value.trim());this.$emit("complete",{reply:e,index:t.index,submit:t.submit})}}},Y=M,B=Object(c["a"])(Y,A,H,!1,null,null,null);B.options.__file="blank-filling.vue";var R=B.exports,D={components:{SingleChoice:O,MultipleChoice:P,BlankFilling:R},props:{question:{type:Object,required:!0},index:{type:Number,required:!0},reply:{}},methods:{complete:function(t){this.$emit("complete",t)}}},G=D,F=(s("de42"),Object(c["a"])(G,I,$,!1,null,"25b4bd36",null));F.options.__file="question-card.vue";var J=F.exports,K={components:{BeforeTest:m,AfterTest:_,Timer:T,QuestionCard:J},props:{title:{type:String,required:!0}},data:function(){return{session:{result:{},loading:!0,preparing:!0,end:!1,test:{},remainningTime:0,remainningQuestions:0,currentIndex:0,replys:[],status:[],flag:!1,timeUsed:0,dataCollected:!1}}},mounted:function(){var t=this,e=localStorage.getItem("testing-session");e?this.session=JSON.parse(e):this.$axios.get("".concat(this.$url.tests,"/").concat(this.title)).then(function(e){t.session.test=e.data,t.session.loading=!1,t.resetTimer()}).catch(function(){t.session.loading=!1})},methods:{start:function(){this.session.preparing=!1,this.resetTimer()},next:function(t){t<0||t>=this.session.test.questions.length||this.$bus.$emit("testing-next",{index:t,submit:!1})},toTimeout:function(){if(this.session.test.settings.timerMode===this.$constants.EACH){if(this.session.currentIndex===this.session.test.questions.length-1)return;this.session.currentIndex+=1,this.refreshCache(),this.resetTimer()}else this.session.test.settings.timerMode===this.$constants.ALL&&this.toSubmit()},refreshCache:function(){localStorage.setItem("testing-session",JSON.stringify(this.session))},cleanCache:function(){localStorage.removeItem("testing-session")},resetTimer:function(){var t=this.session.test.settings.timeLimit,e=t.minutes,s=t.seconds;this.session.remainningTime=60*e*1e3+1e3*s},toComplete:function(t){switch(this.session.replys[this.session.currentIndex]=t.reply,this.session.test.questions[this.session.currentIndex].type){case this.QUESTION_TYPE.SINGLE_CHOICE:t.reply>-1&&(this.session.status[this.session.currentIndex]=!0);break;case this.QUESTION_TYPE.MULTIPLE_CHOICE:t.reply.some(function(t){return t})&&(this.session.status[this.session.currentIndex]=!0);break;case this.QUESTION_TYPE.BLANK_FILLING:t.reply.some(function(t){return t.length>0})&&(this.session.status[this.session.currentIndex]=!0);break}this.session.remainningQuestions=this.session.test.questions.length-this.session.status.reduce(function(t,e){return e?t+1:t},0),t.submit?(this.session.dataCollected=!0,0!==this.session.timeUsed&&this.submit()):(this.session.currentIndex=t.index,this.refreshCache(),this.resetTimer())},getTime:function(t){this.session.timeUsed=t,this.session.dataCollected&&this.submit()},toSubmit:function(){this.$bus.$emit("testing-get-time"),this.$bus.$emit("testing-next",{index:-1,submit:!0})},formatResult:function(){var t=this,e=window.$user,s=this.session.test.questions.reduce(function(e,s,i){var n=!1;return console.log(t),s.type===t.QUESTION_TYPE.MULTIPLE_CHOICE&&t.session.replys[i]&&t.session.replys[i].join("")===s.answers.join("")&&(n=!0),s.type===t.QUESTION_TYPE.BLANK_FILLING&&t.session.replys[i]&&t.session.replys[i].join("")===s.answer.join("")&&(n=!0),s.type===t.QUESTION_TYPE.SINGLE_CHOICE&&-1!==t.session.replys[i]&&t.session.replys[i]===s.answer&&(n=!0),n&&(e+=+s.score),e},0),i=this.session.test.questions.map(function(e,s){return e.type===t.QUESTION_TYPE.MULTIPLE_CHOICE?t.session.replys[s]?{question:e,reply:t.session.replys[s],verdict:t.session.replys[s].join("")===e.answers.join("")?0:1}:{question:e,reply:[],verdict:1}:e.type===t.QUESTION_TYPE.SINGLE_CHOICE?{question:e,reply:t.session.replys[s],verdict:t.session.replys[s]===e.answer?0:1}:e.type===t.QUESTION_TYPE.BLANK_FILLING?t.session.replys[s]?{question:e,reply:t.session.replys[s],verdict:t.session.replys[s].join("")===e.answer.join("")?0:1}:{question:e,reply:t.session.replys[s],verdict:1}:{question:e,reply:null,verdict:!1}}),n={title:this.session.test.title,username:e.username,score:s,details:i};return n},submit:function(){var t=this;if(!this.session.flag){this.cleanCache();var e=this.formatResult();e.createdAt=Date.now();var s=1e3*(60*+this.session.test.settings.timeLimit.minutes+ +this.session.test.settings.timeLimit.seconds);e.timeUsed=this.session.timeUsed,e.timeLimit=s,this.session.flag=!0,this.$axios.post("".concat(this.$url.results),e).then(function(e){t.session.result=e.data,t.session.flag=!1,t.session.end=!0}).catch(function(e){t.session.flag=!1,t.$alert("error",e.message)})}},exit:function(){this.$router.replace("/")},confirm:function(){return window.confirm("进度不会保存, 确定要离开吗?")}},destroyed:function(){this.cleanCache()},beforeRouteLeave:function(t,e,s){this.confirm()?(this.cleanCache(),this.$bus.$emit("changeMode","normal"),window.$mode="normal",s()):s(!1)}},z=K,V=(s("f06c"),Object(c["a"])(z,i,n,!1,null,"72dbf64e",null));V.options.__file="index.vue";e["default"]=V.exports},"67ba":function(t,e,s){},"9e22":function(t,e,s){},d4b6:function(t,e,s){"use strict";var i=s("9e22"),n=s.n(i);n.a},de42:function(t,e,s){"use strict";var i=s("fd87"),n=s.n(i);n.a},f06c:function(t,e,s){"use strict";var i=s("67ba"),n=s.n(i);n.a},fd87:function(t,e,s){}}]);
//# sourceMappingURL=testing.5c92f9f4.js.map