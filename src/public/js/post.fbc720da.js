(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["post"],{"1ffe":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"post flex-column"},[a("i",{staticClass:"page-control fas fa-long-arrow-alt-left",on:{click:function(e){t.$router.go(-1)}}},[t._v("\n    返回\n  ")]),a("h1",{staticClass:"post__header"},[t._v("\n    "+t._s(t.post.title)+"\n  ")]),a("ul",{staticClass:"flex-1"},t._l(t.replys,function(t){return a("li",{key:t._id},[a("reply",{attrs:{reply:t}})],1)})),a("pager",{staticClass:"mt-1",attrs:{len:t.pager.limit,total:t.pager.total,active:t.pager.page},on:{click:t.toPage}}),a("form",{staticClass:"mt-5 post-reply-form pure-form pure-form-stacked",on:{submit:function(e){return e.preventDefault(),t.toReply(e)}}},[a("textarea",{staticClass:"w-100",attrs:{name:"post-reply-input",id:"post-reply-input",cols:"30",rows:"10",required:"",disabled:t.reply.flag}}),a("button",{staticClass:"pure-button",attrs:{disabled:t.reply.flag}},[t._v("Post")])])],1)},l=[],r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reply"},[a("img",{staticClass:"reply-avatar",attrs:{src:t.reply.avatar}}),a("div",{staticClass:"reply-body"},[a("div",{staticClass:"reply-meta"},[a("span",{staticClass:"reply-meta__username"},[t._v("\n        "+t._s(t.reply.username)+"\n      ")]),a("span",{staticClass:"ml-1 reply-meta__createdAt"},[t._v("\n        "+t._s(t._f("formatDateTime")(t.reply.createdAt))+"\n      ")])]),a("div",{staticClass:"reply-content"},[t._v(t._s(t.reply.content))])])])},i=[],n={props:{reply:{type:Object,required:!0}}},o=n,p=(a("bf43"),a("2877")),c=Object(p["a"])(o,r,i,!1,null,"bdeb30de",null);c.options.__file="reply.vue";var u=c.exports,g={components:{Reply:u},props:{title:{type:String,required:!0}},computed:{replys:function(){var t=(this.pager.page-1)*this.pager.limit,e=t+this.pager.limit;return this.post.replys.slice(t,e)}},data:function(){return{loading:!1,post:{title:"",replys:[]},reply:{flag:!1},pager:{page:1,limit:10,lastPage:0,total:0}}},mounted:function(){this.getData()},methods:{toPage:function(t){this.pager.page=t,this.$nextTick(function(){window.scrollTo(0,0)})},getData:function(){var t=this;this.loading=!0,this.$axios.get("".concat(this.$url.posts,"/").concat(this.title)).then(function(e){t.post=e.data,console.log(t.post.replys.length),t.pager.total=e.data.replys.length,t.pager.lastPage=Math.floor(t.pager.total/t.pager.limit),t.pager.total%t.pager.limit!==0&&(t.pager.lastPage+=1),t.loading=!1})},toReply:function(){var t=this;if(!this.reply.flag){var e=document.getElementById("post-reply-input");if(e){var a=e.value.trim();if(a){var s=window.$user,l={title:this.title,username:s.username,avatar:s.avatar,content:a};this.reply.flag=!0,this.$axios.post("".concat(this.$url.posts,"/").concat(this.title,"/replys"),l).then(function(a){e.value="",t.post.replys.push(a.data),t.pager.total+=1,t.pager.lastPage=Math.floor(t.pager.total/t.pager.limit),t.pager.total%t.pager.limit!==0&&(t.pager.lastPage+=1),t.$nextTick(function(){window.scrollTo(0,0)}),t.pager.page=t.pager.lastPage,t.reply.flag=!1})}}}}}},f=g,d=(a("e3dc"),Object(p["a"])(f,s,l,!1,null,"2eb826a7",null));d.options.__file="index.vue";e["default"]=d.exports},"949e":function(t,e,a){},bf43:function(t,e,a){"use strict";var s=a("eb1a"),l=a.n(s);l.a},e3dc:function(t,e,a){"use strict";var s=a("949e"),l=a.n(s);l.a},eb1a:function(t,e,a){}}]);
//# sourceMappingURL=post.fbc720da.js.map