(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["requests"],{"0f1d":function(t,e,s){},3052:function(t,e,s){},"35b3":function(t,e,s){"use strict";var a=s("e1d9"),r=s.n(a);r.a},"4f48":function(t,e,s){"use strict";var a=s("3052"),r=s.n(a);r.a},"55a3":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"request pd-1 flex-column"},[s("div",{staticClass:"request-header"},[s("h1",[t._v("\n      "+t._s(t.request.title)+"\n    ")]),s("p",[t._v("\n      "+t._s(t.request.description)+"\n    ")])]),s("request-comments",{staticClass:"flex-1",attrs:{comments:t.request.comments,approved:t.request.status===t.REQUEST_APPROVED,"approved-index":t.request.approvedIndex,flag:t.comment.flag},on:{approve:t.toApprove,comment:t.toComment}})],1)},r=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex-column"},[t.approved?s("ul",{staticClass:"flex-1"},t._l(t.comments,function(e,a){return s("li",{key:e._id},[s("div",{staticClass:"reply"},[s("div",{staticClass:"reply-left"},[s("img",{staticClass:"reply-avatar",attrs:{src:e.avatar}}),a===t.approvedIndex?s("i",{staticClass:"fas fa-check reply-flag reply-flag--checked"}):t._e()]),s("div",{staticClass:" reply-right"},[s("div",{staticClass:"reply-meta"},[s("span",{staticClass:"reply-meta__username"},[t._v("\n              "+t._s(e.username)+"\n            ")]),s("span",{staticClass:"ml-1 reply-meta__createdAt"},[t._v("\n              "+t._s(t._f("formatDateTime")(e.createdAt))+"\n            ")])]),s("div",{staticClass:"reply-content"},[t._v(t._s(e.content))])])])])})):s("ul",{staticClass:"flex-1"},t._l(t.comments,function(e,a){return s("li",{key:e._id},[s("div",{staticClass:"reply"},[s("div",{staticClass:"reply-left"},[s("img",{staticClass:"reply-avatar",attrs:{src:e.avatar}}),s("i",{staticClass:"fas fa-check reply-flag",on:{click:function(e){t.toApprove(a)}}})]),s("div",{staticClass:"reply-right"},[s("div",{staticClass:"reply-meta"},[s("span",{staticClass:"reply-meta__username"},[t._v("\n              "+t._s(e.username)+"\n            ")]),s("span",{staticClass:"ml-1 reply-meta__createdAt"},[t._v("\n              "+t._s(t._f("formatDateTime")(e.createdAt))+"\n            ")])]),s("div",{staticClass:"reply-content"},[t._v(t._s(e.content))])])])])})),s("form",{staticClass:"mt-5 post-reply-form pure-form pure-form-stacked",on:{submit:function(e){return e.preventDefault(),t.toComment(e)}}},[s("textarea",{staticClass:"w-100",attrs:{name:"request-comment-input",id:"request-comment-input",cols:"30",rows:"10",required:"",disabled:t.flag}}),s("button",{staticClass:"pure-button",attrs:{disabled:t.flag}},[t._v("Post")])])])},i=[],o=(s("c5f6"),s("cadf"),s("551c"),s("097d"),{props:{comments:{type:Array,required:!0},approved:{type:Boolean,required:!0},approvedIndex:{type:Number},flag:{type:Boolean,default:!1}},methods:{toApprove:function(t){this.$emit("approve",t)},toComment:function(){if(!this.flag){var t=document.getElementById("request-comment-input");t&&t.value.trim()&&(this.$emit("comment",t.value.trim()),t.value="")}}}}),l=o,u=(s("b691"),s("2877")),c=Object(u["a"])(l,n,i,!1,null,"54061380",null);c.options.__file="request-comments.vue";var d=c.exports,p={components:{RequestComments:d},props:{title:{type:String,required:!0}},data:function(){return{request:{title:"",description:"",comments:[]},loading:!0,comment:{flag:!1}}},mounted:function(){this.getData()},methods:{getData:function(){var t=this;this.$axios.get("".concat(this.$url.requests,"/").concat(this.title)).then(function(e){t.request=e.data,t.loading=!1})},toComment:function(t){var e=this;if(!this.comment.flag){var s=window.$user,a={title:this.title,username:s.username,avatar:s.avatar,content:t};this.comment.flag=!0,this.$axios.post("".concat(this.$url.requests,"/").concat(this.title,"/comments"),a).then(function(t){e.request.comments.push(t.data),e.comment.flag=!1}).catch(function(){e.comment.flag=!1})}},toApprove:function(t){this.request.status=0,this.request.approvedIndex=t;var e={status:this.request.status,approvedIndex:this.request.approvedIndex};this.$axios.put("".concat(this.$url.requests,"/").concat(this.title,"/status"),e)}}},m=p,f=(s("f2c9"),Object(u["a"])(m,a,r,!1,null,"5090a292",null));f.options.__file="index.vue";e["default"]=f.exports},"97cb":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pd-1 flex-column ml-auto mr-auto"},[s("button",{staticClass:"pure-button pure-button-primary flex-item-end",on:{click:t.toAddRequest}},[t._v("\n  发起请求\n  ")]),s("request-filter",{staticClass:"mt-1",on:{search:t.toSearch,reset:t.toReset}}),s("request-list",{staticClass:"flex-1 mt-1 relative",attrs:{list:t.list,loading:t.loading}}),s("pager",{staticClass:"mt-auto",attrs:{len:t.pager.len,total:t.pager.total,active:t.pager.page},on:{click:t.toPage}})],1)},r=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{staticClass:"pure-form pure-form-aligned pd-5 bd-1 shadow-2"},[s("div",{staticClass:"pure-control-group flex-row form-group"},[s("label",{attrs:{for:"keyword"}},[t._v("搜索")]),s("select",{attrs:{name:"target",id:"target"},domProps:{value:t.filter.target}},[s("option",{attrs:{value:""}},[t._v("任何")]),s("option",{attrs:{value:"title"}},[t._v("标题")]),s("option",{attrs:{value:"description"}},[t._v("描述")])]),s("input",{staticClass:"ml-1",attrs:{type:"text",name:"keyword",id:"keyword"},domProps:{value:t.filter.keyword}})]),s("div",{staticClass:"pure-control-group form-group"},[s("label",{attrs:{for:"status"}},[t._v("状态")]),s("select",{attrs:{name:"status",id:"status"},domProps:{value:t.filter.status}},[s("option",{attrs:{value:""}},[t._v("任何")]),s("option",{attrs:{value:"0"}},[t._v("接受")]),s("option",{attrs:{value:"1"}},[t._v("未接受")])])]),s("div",{staticClass:"pure-control-group"},[s("label",{attrs:{for:""}}),s("button",{staticClass:"pure-button pure-button-primary",on:{click:function(e){return e.preventDefault(),t.toSearch(e)}}},[t._v("搜索")]),s("button",{staticClass:"ml-1 pure-button button-warning",on:{click:function(e){return e.preventDefault(),t.toReset(e)}}},[t._v("重置")])])])},i=[],o=(s("cadf"),s("551c"),s("097d"),{data:function(){return{filter:{keyword:"",target:"",status:""}}},methods:{toSearch:function(){var t=document.getElementById("keyword").value,e=document.getElementById("target").value,s=document.getElementById("status").value,a={keyword:t,target:e,status:s};this.$emit("search",a)},toReset:function(){document.getElementById("keyword").value="",document.getElementById("target").value="",document.getElementById("status").value="",this.$emit("reset")}}}),l=o,u=(s("4f48"),s("2877")),c=Object(u["a"])(l,n,i,!1,null,"048f0a5a",null);c.options.__file="request-filter.vue";var d=c.exports,p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.loading||0!==t.list.length?s("table",{staticClass:"w-100 table-fixed pure-table pure-table-bordered"},[s("thead",[s("tr",[s("th",{staticClass:"w-50"},[t._v("标题")]),s("th",[t._v("时间")]),s("th",[t._v("用户名")]),s("th",[t._v("VOTE")]),s("th",[t._v("评论")]),s("th",[t._v("状态")])])]),s("tbody",t._l(t.list,function(e){return s("tr",{key:e.title},[s("td",{staticClass:"w-50"},[s("router-link",{attrs:{to:"/requests/"+e.title}},[t._v("\n        "+t._s(e.title)+"\n      ")])],1),s("td",{staticClass:"w-10"},[t._v(t._s(t._f("clock2")(e.createdAt)))]),s("td",{staticClass:"w-10"},[t._v(t._s(e.username))]),s("td",{staticClass:"w-10"},[t._v(t._s(e.votes))]),s("td",{staticClass:"w-10"},[t._v(t._s(e.comments.length))]),s("td",{staticClass:"w-10"},[t._v("\n      "+t._s(0===e.status?"Approved":"Unapproved")+"\n    ")])])}))]):s("no-data")},m=[],f={props:{list:{type:Array,required:!0},loading:{type:Boolean,required:!0}}},v=f,_=Object(u["a"])(v,p,m,!1,null,null,null);_.options.__file="request-list.vue";var g=_.exports,h={components:{RequestFilter:d,RequestList:g},data:function(){return{loading:!0,list:[],pager:{page:1,len:10,total:0},filter:{status:"",keyword:"",target:""}}},mounted:function(){this.getData()},methods:{getData:function(){var t=this,e="keyword=".concat(this.filter.keyword,"&status=").concat(this.filter.status,"&target=").concat(this.filter.target,"&page=").concat(this.pager.page,"&limit=").concat(this.pager.len);this.$axios.get("".concat(this.$url.requests,"?").concat(e)).then(function(e){t.list=e.data.results,t.pager.total=e.data.total,t.loading=!1})},toSearch:function(t){this.filter=t,this.getData()},toReset:function(){this.filter={target:"",keyword:"",status:""},this.getData()},toAddRequest:function(){window.$user?this.$router.push("/add/request"):this.$alert("error","请先登录")},toPage:function(t){this.pager.page=t,this.getData()}}},y=h,C=(s("35b3"),Object(u["a"])(y,a,r,!1,null,"fe28821e",null));C.options.__file="index.vue";e["default"]=C.exports},b691:function(t,e,s){"use strict";var a=s("0f1d"),r=s.n(a);r.a},bffb:function(t,e,s){},e1d9:function(t,e,s){},f2c9:function(t,e,s){"use strict";var a=s("bffb"),r=s.n(a);r.a}}]);
//# sourceMappingURL=requests.2f7b191a.js.map